default_platform(:android)

  default_platform(:android)
  ######################################################
  # Development lane: Build and deploy using Firebase App Distribution
  ######################################################
  desc "Deploy Development Build to Firebase App Distribution"
  lane :deploy_dev do
#     build_apk(flavor: "dev", build_type: "Release")

    firebase_app_distribution(
      app: "1:903057481620:android:15a6a143abbe80aa46b981",
      firebase_cli_token: ENV["FIREBASE_TOKEN"],
      apk_path: "../build/app/outputs/flutter-apk/app-dev-release.apk",
      testers: "huy.nguyenhuy141120@gmail.com",
      release_notes: "Automated Development build via Fastlane"
    )
  end

  ######################################################
  # Staging lane: Build and deploy using Firebase App Distribution
  ######################################################
  desc "Deploy Staging Build to Firebase App Distribution"
  lane :deploy_staging do
    build_apk(flavor: "staging", build_type: "Release")

    firebase_app_distribution(
      app: "your_firebase_app_id_staging",
      firebase_cli_token: ENV["FIREBASE_TOKEN"],
      apk_path: "../build/app/outputs/flutter-apk/app-staging-release.apk",
      testers: "testers@example.com",
      release_notes: "Automated Staging build via Fastlane"
    )
  end

  ######################################################
  # Production lane: Build and deploy using Firebase App Distribution
  ######################################################
  desc "Deploy Production Build to Firebase App Distribution"
  lane :deploy_prod do
    build_apk(flavor: "prod", build_type: "Release")

    firebase_app_distribution(
      app: "your_firebase_app_id_prod",
      firebase_cli_token: ENV["FIREBASE_TOKEN"],
      apk_path: "../build/app/outputs/flutter-apk/app-prod-release.apk",
      testers: "testers@example.com",
      release_notes: "Automated Production build via Fastlane"
    )
  end

  ######################################################
  # Continuous Deployment lane: Choose deployment based on current branch
  ######################################################
  desc "Continuous Deployment - automatically select deployment lane based on git branch"
  lane :continuous_deploy do
    branch = sh("git rev-parse --abbrev-ref HEAD").strip
    UI.message("Deploying for branch: #{branch}")

    case branch
    when "master"
      deploy_prod
    when "staging"
      deploy_staging
    else
      deploy_dev
    end
  end